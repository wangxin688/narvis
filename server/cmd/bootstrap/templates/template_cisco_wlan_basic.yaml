zabbix_export:
  version: '7.0'
  template_groups:
    - uuid: 1877cc163d5b46e1a8121d91b1dbe38e
      name: Templates/narvis
  templates:
    - uuid: ace8e140af14491092453aa29903be28
      template: template_cisco_wlan_basic
      name: template_cisco_wlan_basic
      description: |
        Template Cisco IOS Software releases 12.2(3.5) or later
        
        MIBs used:
        CISCO-MEMORY-POOL-MIB
        IF-MIB
        EtherLike-MIB
        HOST-RESOURCES-MIB
        SNMPv2-MIB
        CISCO-ENVMON-MIB
        CISCO-PROCESS-MIB
        ENTITY-MIB
        
        Known Issues:
        
          Description: no if(in|out)(Errors|Discards) are available for vlan ifType
          Version: IOS for example: 12.1(22)EA11, 15.4(3)M2
          Device: C2911, C7600
        
        Generated by official Zabbix template tool "Templator" 2.0.0
      templates:
        - name: template_interface_basic
      groups:
        - name: Templates/narvis
      items:
        - uuid: 4c1b6670265946dea22b8a849d92c963
          name: snmp_ap_walk
          type: SNMP_AGENT
          snmp_oid: 'walk[1.3.6.1.4.1.14179.2.2.1.1.3, 1.3.6.1.4.1.14179.2.2.1.1.6,1.3.6.1.4.1.9.9.513.1.1.1.1.6,1.3.6.1.4.1.9.9.513.1.1.1.1.57,1.3.6.1.4.1.9.9.513.1.1.1.1.55]'
          key: aireos.ap.walk
          delay: 3m
          history: '0'
          value_type: TEXT
          trends: '0'
          timeout: 30s
        - uuid: bec379ac9e86470bb7e02611fcf0960a
          name: icmp_ping
          type: SIMPLE
          key: icmpping
          history: 7d
          trends: '0'
          valuemap:
            name: 'Service state'
          triggers:
            - uuid: efea2a8cb8014d2296202005dbcb7cfd
              expression: 'max(/template_cisco_wlan_basic/icmpping,#3)=0'
              name: unavailable_by_icmp_ping
              priority: HIGH
              description: 'Last three attempts returned timeout.  Please check device connectivity.'
              manual_close: 'YES'
        - uuid: 4b81c48dd4f74d60a736d017fa684202
          name: icmp_loss
          type: SIMPLE
          key: icmppingloss
          history: 7d
          value_type: FLOAT
          trends: '0'
          units: '%'
          triggers:
            - uuid: 0a5db7b17e6c45e3b56cf00b676e36bd
              expression: 'min(/template_cisco_wlan_basic/icmppingloss,5m)>{$ICMP_LOSS_WARN} and min(/template_cisco_wlan_basic/icmppingloss,5m)<100'
              name: high_icmp_ping_loss
              opdata: 'Loss: {ITEM.LASTVALUE1}'
              priority: WARNING
              manual_close: 'YES'
              dependencies:
                - name: unavailable_by_icmp_ping
                  expression: 'max(/template_cisco_wlan_basic/icmpping,#3)=0'
        - uuid: 61a2c3f9119f4439ba93a81c3b34d98f
          name: icmp_response_time
          type: SIMPLE
          key: icmppingsec
          history: 7d
          value_type: FLOAT
          trends: '0'
          units: s
          triggers:
            - uuid: b889ccc2a57e4015b4aa0dd8e7d1f5e4
              expression: 'avg(/template_cisco_wlan_basic/icmppingsec,5m)>{$ICMP_RESPONSE_TIME_WARN}'
              name: high_icmp_ping_response_time
              opdata: 'Value: {ITEM.LASTVALUE1}'
              priority: WARNING
              manual_close: 'YES'
              dependencies:
                - name: high_icmp_ping_loss
                  expression: 'min(/template_cisco_wlan_basic/icmppingloss,5m)>{$ICMP_LOSS_WARN} and min(/template_cisco_wlan_basic/icmppingloss,5m)<100'
                - name: unavailable_by_icmp_ping
                  expression: 'max(/template_cisco_wlan_basic/icmpping,#3)=0'
        - uuid: aebbdc6ffd4f479993cf2d997d89f9fb
          name: snmp_walk_fans
          type: SNMP_AGENT
          snmp_oid: 'walk[1.3.6.1.4.1.9.9.13.1.4.1.2,1.3.6.1.4.1.9.9.13.1.4.1.3]'
          key: sensor.fans.walk
          delay: 3m
          history: '0'
          value_type: TEXT
          trends: '0'
          description: 'Discovering system fans.'
        - uuid: ed11da838a104704a1747268bd387ec4
          name: snmp_walk_psus
          type: SNMP_AGENT
          snmp_oid: 'walk[1.3.6.1.4.1.9.9.13.1.5.1.2,1.3.6.1.4.1.9.9.13.1.5.1.3]'
          key: sensor.psu.walk
          delay: 3m
          history: '0'
          value_type: TEXT
          trends: '0'
          description: 'The table of power supply status maintained by the environmental monitor card.'
        - uuid: 22df67545da440e0bfc3e7f4e6fe092b
          name: snmp_walk_temperature_sensors
          type: SNMP_AGENT
          snmp_oid: 'walk[1.3.6.1.4.1.9.9.13.1.3.1.2,1.3.6.1.4.1.9.9.13.1.3.1.3,1.3.6.1.4.1.9.9.13.1.3.1.6]'
          key: sensor.temp.walk
          delay: 3m
          history: '0'
          value_type: TEXT
          trends: '0'
          description: 'Discovery of ciscoEnvMonTemperatureTable (ciscoEnvMonTemperatureDescr), a table of ambient temperature status maintained by the environmental monitor.'
        - uuid: 3d81db189a34432fbbab1d0274423c83
          name: snmp_walk_system_cpus
          type: SNMP_AGENT
          snmp_oid: 'walk[1.3.6.1.4.1.9.9.109.1.1.1.1.5,1.3.6.1.4.1.9.9.109.1.1.1.1.8]'
          key: system.cpu.walk
          delay: 3m
          history: '0'
          value_type: TEXT
          trends: '0'
          description: |
            If your IOS device has several CPUs, you must use CISCO-PROCESS-MIB and its object cpmCPUTotal5minRev from the table called cpmCPUTotalTable,
            indexed with cpmCPUTotalIndex.
            This table allows CISCO-PROCESS-MIB to keep CPU statistics for different physical entities in the router,
            like different CPU chips, group of CPUs, or CPUs in different modules/cards.
            In case of a single CPU, cpmCPUTotalTable has only one entry.
        - uuid: ffb9e2ec2a5e412b98f98948bbe1e497
          name: uptime
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.3.0
          key: 'system.net.uptime[sysUpTime.0]'
          delay: 3m
          history: 7d
          trends: '0'
          units: uptime
          description: |
            MIB: SNMPv2-MIB
            The time (in hundredths of a second) since the network management portion of the system was last re-initialized.
          preprocessing:
            - type: MULTIPLIER
              parameters:
                - '0.01'
        - uuid: 3a78433dc7aa49baa2c1afb1f59cdb2e
          name: snmp_walk_memory
          type: SNMP_AGENT
          snmp_oid: 'walk[1.3.6.1.4.1.9.9.48.1.1.1.2,1.3.6.1.4.1.9.9.48.1.1.1.5,1.3.6.1.4.1.9.9.48.1.1.1.6]'
          key: vm.memory.walk
          delay: 3m
          history: '0'
          value_type: TEXT
          trends: '0'
          description: |
            MIB: CISCO-MEMORY-POOL-MIB
            Discovery of ciscoMemoryPoolTable, a table of memory pool monitoring entries.
            http://www.cisco.com/c/en/us/support/docs/ip/simple-network-management-protocol-snmp/15216-contiguous-memory.html.
        - uuid: c56193a2b72341a49d969d4dfe71fc91
          name: snmp_agent_availability
          type: INTERNAL
          key: 'zabbix[host,snmp,available]'
          history: 7d
          trends: '0'
          description: |
            Availability of SNMP checks on the host. The value of this item corresponds to availability icons in the host list.
            Possible value:
            0 - not available
            1 - available
            2 - unknown
          valuemap:
            name: zabbix.host.available
          preprocessing:
            - type: JAVASCRIPT
              parameters:
                - |
                  if (value == 2) {
                     return 0
                  } else {
                     return value
                  }
                  }
          triggers:
            - uuid: 3aca4e7c0d1c4bd0a882d3c1b8180892
              expression: 'max(/template_cisco_wlan_basic/zabbix[host,snmp,available],{$SNMP.TIMEOUT})=0'
              name: no_snmp_data_collection
              opdata: 'Current state: {ITEM.LASTVALUE1}'
              priority: WARNING
              description: 'SNMP is not available for polling. Please check device connectivity and SNMP settings.'
              manual_close: 'YES'
              dependencies:
                - name: unavailable_by_icmp_ping
                  expression: 'max(/template_cisco_wlan_basic/icmpping,#3)=0'
      discovery_rules:
        - uuid: f8d45245cb474c89b25a3e71a7c2f1bf
          name: radio_flex_discovery
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#RADIOTYPE},1.3.6.1.4.1.14179.2.2.2.1.2,{#CHANNEL},1.3.6.1.4.1.14179.2.2.2.1.4,{#BANDWIDTH},1.3.6.1.4.1.9.9.513.1.2.1.1.23]'
          key: aireos.radio.discovery
          delay: 1h
          filter:
            conditions:
              - macro: '{#CHANNEL}'
                value: (0)
                operator: NOT_MATCHES_REGEX
                formulaid: A
          lifetime_type: DELETE_IMMEDIATELY
          lifetime: '0'
          item_prototypes:
            - uuid: 054f227b87d6490589afc39b7261373d
              name: channel_associated_clients
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.14179.2.2.13.1.4.{#SNMPINDEX}'
              key: 'aireos.channel.clients.[{#SNMPINDEX}]'
              delay: 3m
              history: 7d
              trends: '0'
              tags:
                - tag: apMac
                  value: '{#APMAC}'
                - tag: bandwidth
                  value: '{#BANDWIDTH}'
                - tag: channel
                  value: '{#CHANNEL}'
                - tag: radioType
                  value: '{#RADIOTYPE}'
            - uuid: 4b1b2c8dabf341c191b5cb1afb125795
              name: channel_interference_rate
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.14179.2.2.14.1.22.{#SNMPINDEX}.{#CHANNEL}'
              key: 'aireos.channel.interfer.[{#SNMPINDEX}]'
              delay: 3m
              history: 7d
              trends: '0'
              status: DISABLED
              discover: NO_DISCOVER
              units: '%'
              tags:
                - tag: apMac
                  value: '{#APMAC}'
                - tag: bandwidth
                  value: '{#BANDWIDTH}'
                - tag: channel
                  value: '{#CHANNEL}'
                - tag: radioType
                  value: '{#RADIOTYPE}'
            - uuid: 28f66d6dc4e242c99b9a3c5f57e55c42
              name: channel_noise
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.14179.2.2.15.1.21.{#SNMPINDEX}.{#CHANNEL}'
              key: 'aireos.channel.noise.[{#SNMPINDEX}]'
              delay: 3m
              history: 7d
              trends: '0'
              status: DISABLED
              discover: NO_DISCOVER
              units: dBm
              preprocessing:
                - type: JAVASCRIPT
                  parameters:
                    - 'return parseInt(value)'
              tags:
                - tag: apMac
                  value: '{#APMAC}'
                - tag: bandwidth
                  value: '{#BANDWIDTH}'
                - tag: channel
                  value: '{#CHANNEL}'
                - tag: radioType
                  value: '{#RADIOTYPE}'
            - uuid: e9cc9d78f9f1455090f8ea2e6bc40ffc
              name: channel_transmit_power
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.14179.2.2.2.1.6.{#SNMPINDEX}'
              key: 'aireos.channel.power.[{#SNMPINDEX}]'
              delay: 3m
              history: 7d
              trends: '0'
              units: dBm
              preprocessing:
                - type: JAVASCRIPT
                  parameters:
                    - 'return 26 - value*3'
              tags:
                - tag: apMac
                  value: '{#APMAC}'
                - tag: bandwidth
                  value: '{#BANDWIDTH}'
                - tag: channel
                  value: '{#CHANNEL}'
                - tag: radioType
                  value: '{#RADIOTYPE}'
            - uuid: dc99a1db20804d72a68a0817dfae1b8c
              name: channel_utlization
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.14179.2.2.13.1.3.{#SNMPINDEX}'
              key: 'aireos.channel.utlization.[{#SNMPINDEX}]'
              delay: 3m
              history: 7d
              trends: '0'
              units: '%'
              tags:
                - tag: apMac
                  value: '{#APMAC}'
                - tag: bandwidth
                  value: '{#BANDWIDTH}'
                - tag: channel
                  value: '{#CHANNEL}'
                - tag: radioType
                  value: '{#RADIOTYPE}'
          preprocessing:
            - type: JAVASCRIPT
              parameters:
                - |
                  function padStart(str, targetLength, padString) {
                      str = String(str);
                      while (str.length < targetLength) {
                        str = padString + str;
                      }
                      return str;
                    }
                  function convertMac(mac) {
                      return mac
                        .split('.')
                        .map(function(num) {
                          return padStart(parseInt(num).toString(16), 2, '0');
                        })
                        .join(':'); // 用 ":" 连接
                    }
                  var obj=JSON.parse(value)
                  for (i = 0; i < Object.keys(obj).length; i++) {
                    if (obj[i]['{#RADIOTYPE}'] === "1") {
                      obj[i]['{#RADIOTYPE}'] = "2.4GHz"
                    } else if (obj[i]['{#RADIOTYPE}'] === "2") {
                      obj[i]['{#RADIOTYPE}'] = "5GHz"
                    } else if  (obj[i]['{#RADIOTYPE}'] === "4") {
                      obj[i]['{#RADIOTYPE}'] = "6GHz"
                    }
                    if (obj[i]['{#BANDWIDTH}']==='3') {
                      obj[i]['{#BANDWIDTH}'] = '20MHz'
                    } else if (obj[i]['{#BANDWIDTH}']==='4') {
                      obj[i]['{#BANDWIDTH}']= '40MHz'
                    } else if (obj[i]['{#BANDWIDTH}']==='5') {
                      obj[i]['{#BANDWIDTH}'] = '80MHz'
                    } else if (obj[i]['{#BANDWIDTH}']==='6') {
                      obj[i]['{#BANDWIDTH}'] = '160MHz'
                    }
                    obj[i]['{#APMAC}'] = convertMac(obj[i]['{#SNMPINDEX}'].slice(1,-2))
                  }
                  return  JSON.stringify(obj)
          overrides:
            - name: 'override 2.4G'
              step: '1'
              filter:
                conditions:
                  - macro: '{#RADIOTYPE}'
                    value: 2.4GHz
                    formulaid: A
              operations:
                - operationobject: TRIGGER_PROTOTYPE
                  value: high_channel_noise
                  discover: NO_DISCOVER
                - operationobject: TRIGGER_PROTOTYPE
                  value: high_channel_utilization
                  discover: NO_DISCOVER
                - operationobject: TRIGGER_PROTOTYPE
                  value: high_client_num
                  discover: NO_DISCOVER
        - uuid: 1866e8cd7db546f2a4d992405c90c7e4
          name: ap_discovery
          type: DEPENDENT
          key: ap.discovery
          delay: '0'
          lifetime_type: DELETE_IMMEDIATELY
          lifetime: '0'
          item_prototypes:
            - uuid: 06ef233645b0469bae30684a30cf266b
              name: ap_cpu_utilization
              type: DEPENDENT
              key: 'ap.cpu.utilization.[{#SNMPINDEX}]'
              delay: '0'
              history: 7d
              trends: '0'
              units: '%'
              preprocessing:
                - type: SNMP_WALK_VALUE
                  parameters:
                    - '1.3.6.1.4.1.9.9.513.1.1.1.1.57.{#SNMPINDEX}'
                    - '0'
              master_item:
                key: aireos.ap.walk
              tags:
                - tag: apName
                  value: '{#APNAME}'
            - uuid: 68788865517c412fabf66a40581cd80f
              name: ap_memory_utilization
              type: DEPENDENT
              key: 'ap.memory.[{#SNMPINDEX}]'
              delay: '0'
              history: 7d
              trends: '0'
              units: '%'
              preprocessing:
                - type: SNMP_WALK_VALUE
                  parameters:
                    - '1.3.6.1.4.1.9.9.513.1.1.1.1.55.{#SNMPINDEX}'
                    - '0'
              master_item:
                key: aireos.ap.walk
              tags:
                - tag: apName
                  value: '{#APNAME}'
            - uuid: 24936e2b2ab14e808ac5622c1161e25e
              name: ap_status
              type: DEPENDENT
              key: 'ap.status.[{#SNMPINDEX}]'
              delay: '0'
              preprocessing:
                - type: SNMP_WALK_VALUE
                  parameters:
                    - '1.3.6.1.4.1.9.9.513.1.1.1.1.6.{#SNMPINDEX}'
                    - '0'
                - type: JAVASCRIPT
                  parameters:
                    - |
                      if (value != 1) {
                          return 2
                      } else {
                          return 1
                      }
              master_item:
                key: aireos.ap.walk
              tags:
                - tag: apName
                  value: '{#APNAME}'
            - uuid: 4cad63fae5bf4e629098239692c13915
              name: ap_uptime
              type: DEPENDENT
              key: 'ap.uptime.[{#SNMPINDEX}]'
              delay: '0'
              history: 7d
              trends: '0'
              units: uptime
              preprocessing:
                - type: SNMP_WALK_VALUE
                  parameters:
                    - '1.3.6.1.4.1.9.9.513.1.1.1.1.6.{#SNMPINDEX}'
                    - '0'
                - type: MULTIPLIER
                  parameters:
                    - '0.01'
              master_item:
                key: aireos.ap.walk
              tags:
                - tag: apName
                  value: '{#APNAME}'
          master_item:
            key: aireos.ap.walk
          preprocessing:
            - type: SNMP_WALK_TO_JSON
              parameters:
                - '{#APNAME}'
                - 1.3.6.1.4.1.14179.2.2.1.1.3
                - '0'
        - uuid: e4e6bdd2d42c4186a0858a4e1e5fb8cd
          name: cpu_discovery
          type: DEPENDENT
          key: cpu.discovery
          delay: '0'
          lifetime_type: DELETE_IMMEDIATELY
          lifetime: '0'
          description: |
            If your IOS device has several CPUs, you must use CISCO-PROCESS-MIB and its object cpmCPUTotal5minRev from the table called cpmCPUTotalTable,
            indexed with cpmCPUTotalIndex.
            This table allows CISCO-PROCESS-MIB to keep CPU statistics for different physical entities in the router,
            like different CPU chips, group of CPUs, or CPUs in different modules/cards.
            In case of a single CPU, cpmCPUTotalTable has only one entry.
          item_prototypes:
            - uuid: 66513e35adf3423c84788517d2c1ff91
              name: cpu_utilization
              type: DEPENDENT
              key: 'system.cpu.util[cpmCPUTotal5minRev.{#SNMPINDEX}]'
              delay: '0'
              history: 7d
              value_type: FLOAT
              trends: '0'
              units: '%'
              description: |
                MIB: CISCO-PROCESS-MIB
                The cpmCPUTotal5minRev MIB object provides a more accurate view of the performance of the router over time than the MIB objects cpmCPUTotal1minRev and cpmCPUTotal5secRev . These MIB objects are not accurate because they look at CPU at one minute and five second intervals, respectively. These MIBs enable you to monitor the trends and plan the capacity of your network. The recommended baseline rising threshold for cpmCPUTotal5minRev is 90 percent. Depending on the platform, some routers that run at 90 percent, for example, 2500s, can exhibit performance degradation versus a high-end router, for example, the 7500 series, which can operate fine.
                Reference: http://www.cisco.com/c/en/us/support/docs/ip/simple-network-management-protocol-snmp/15215-collect-cpu-util-snmp.html
              preprocessing:
                - type: SNMP_WALK_VALUE
                  parameters:
                    - '1.3.6.1.4.1.9.9.109.1.1.1.1.8.{#SNMPINDEX}'
                    - '0'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 5m
              master_item:
                key: system.cpu.walk
              tags:
                - tag: cpu
                  value: '{#SNMPINDEX}'
              trigger_prototypes:
                - uuid: 598dccff90394685a46977ef998d52ef
                  expression: 'min(/template_cisco_wlan_basic/system.cpu.util[cpmCPUTotal5minRev.{#SNMPINDEX}],5m)>{$CPU.USAGE.HIGH}'
                  name: high_cpu_utilization
                  event_name: '#{#SNMPINDEX}: High CPU utilization (over {$CPU.USAGE.HIGH}% for 5m)'
                  opdata: 'Current utilization: {ITEM.LASTVALUE1}'
                  priority: WARNING
                  description: 'The CPU utilization is too high. The system might be slow to respond.'
                  manual_close: 'YES'
                  tags:
                    - tag: cpu
                      value: '{#SNMPINDEX}:'
          master_item:
            key: system.cpu.walk
          preprocessing:
            - type: SNMP_WALK_TO_JSON
              parameters:
                - '{#SNMPVALUE}'
                - 1.3.6.1.4.1.9.9.109.1.1.1.1.5
                - '0'
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
        - uuid: 5b5aec3f4c124cac9b2bb429e0ce7a62
          name: fan_discovery
          type: DEPENDENT
          key: fan.discovery
          delay: '0'
          lifetime_type: DELETE_IMMEDIATELY
          lifetime: '0'
          description: 'The table of fan status maintained by the environmental monitor.'
          item_prototypes:
            - uuid: 793a7fe2f4cf474ca640ef9c740a614f
              name: fan_status
              type: DEPENDENT
              key: 'sensor.fan.status[ciscoEnvMonFanState.{#SNMPINDEX}]'
              delay: '0'
              history: 1w
              trends: '0'
              description: 'MIB: CISCO-ENVMON-MIB'
              valuemap:
                name: entity_status
              preprocessing:
                - type: SNMP_WALK_VALUE
                  parameters:
                    - '1.3.6.1.4.1.9.9.13.1.4.1.3.{#SNMPINDEX}'
                    - '0'
                - type: JAVASCRIPT
                  parameters:
                    - |
                      if (value != 2 && value !=1) {
                          return 2
                      } else if (value == 2){
                          return 2
                      } else {
                          return 1
                      }
              master_item:
                key: sensor.fans.walk
              tags:
                - tag: fan
                  value: '{#SENSOR_INFO}'
              trigger_prototypes:
                - uuid: 0436b852fbd044fe9097bee77cda50db
                  expression: 'min(/template_cisco_wlan_basic/sensor.fan.status[ciscoEnvMonFanState.{#SNMPINDEX}],#3:now-10m)>1'
                  name: fan_status_abnormal
                  opdata: 'Current state: {ITEM.LASTVALUE1}'
                  priority: AVERAGE
                  description: 'Please check the fan unit'
                  manual_close: 'YES'
                  tags:
                    - tag: fan
                      value: '{#SENSOR_INFO}'
          master_item:
            key: sensor.fans.walk
          preprocessing:
            - type: SNMP_WALK_TO_JSON
              parameters:
                - '{#SENSOR_INFO}'
                - 1.3.6.1.4.1.9.9.13.1.4.1.2
                - '0'
              error_handler: DISCARD_VALUE
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
        - uuid: eeb13c492101467e8279334e67cc180a
          name: memory_discovery
          type: DEPENDENT
          key: memory.discovery
          delay: '0'
          lifetime_type: DELETE_IMMEDIATELY
          lifetime: '0'
          description: |
            Discovery of ciscoMemoryPoolTable, a table of memory pool monitoring entries.
            http://www.cisco.com/c/en/us/support/docs/ip/simple-network-management-protocol-snmp/15216-contiguous-memory.html
          item_prototypes:
            - uuid: 32b1fc5fde1240b0a5f4e47e24669429
              name: free_memory
              type: DEPENDENT
              key: 'vm.memory.free[ciscoMemoryPoolFree.{#SNMPINDEX}]'
              delay: '0'
              history: 7d
              trends: '0'
              units: B
              description: |
                MIB: CISCO-MEMORY-POOL-MIB
                Indicates the number of bytes from the memory pool that are currently unused on the managed device. Note that the sum of ciscoMemoryPoolUsed and ciscoMemoryPoolFree is the total amount of memory in the pool
                Reference: http://www.cisco.com/c/en/us/support/docs/ip/simple-network-management-protocol-snmp/15216-contiguous-memory.html
              preprocessing:
                - type: SNMP_WALK_VALUE
                  parameters:
                    - '1.3.6.1.4.1.9.9.48.1.1.1.6.{#SNMPINDEX}'
                    - '0'
              master_item:
                key: vm.memory.walk
            - uuid: 614e36dbe67444818d4e794741666731
              name: used_memory
              type: DEPENDENT
              key: 'vm.memory.used[ciscoMemoryPoolUsed.{#SNMPINDEX}]'
              delay: '0'
              history: 7d
              trends: '0'
              units: B
              description: |
                MIB: CISCO-MEMORY-POOL-MIB
                Indicates the number of bytes from the memory pool that are currently in use by applications on the managed device.
                Reference: http://www.cisco.com/c/en/us/support/docs/ip/simple-network-management-protocol-snmp/15216-contiguous-memory.html
              preprocessing:
                - type: SNMP_WALK_VALUE
                  parameters:
                    - '1.3.6.1.4.1.9.9.48.1.1.1.5.{#SNMPINDEX}'
                    - '0'
              master_item:
                key: vm.memory.walk
            - uuid: 64c15b0f0af74c2fadb0bf303471c144
              name: memory_utilization
              type: CALCULATED
              key: 'vm.memory.util[vm.memory.util.{#SNMPINDEX}]'
              delay: 3m
              history: 7d
              value_type: FLOAT
              trends: '0'
              units: '%'
              params: 'last(//vm.memory.used[ciscoMemoryPoolUsed.{#SNMPINDEX}],#1:now-5m)/(last(//vm.memory.free[ciscoMemoryPoolFree.{#SNMPINDEX}],#1:now-5m)+last(//vm.memory.used[ciscoMemoryPoolUsed.{#SNMPINDEX}],#1:now-5m))*100'
              description: 'Memory utilization in %.'
              tags:
                - tag: entity
                  value: '{#SNMPVALUE}'
              trigger_prototypes:
                - uuid: 06dbd3fcbd794dc6a1ed884bc8c79153
                  expression: 'min(/template_cisco_wlan_basic/vm.memory.util[vm.memory.util.{#SNMPINDEX}],5m)>{$MEMORY.UTIL.HIGH}'
                  name: high_memory_utilization
                  event_name: '{#SNMPVALUE}: High memory utilization (>{$MEMORY.UTIL.HIGH}% for 5m)'
                  priority: AVERAGE
                  description: 'The system is running out of free memory.'
                  manual_close: 'YES'
                  tags:
                    - tag: entity
                      value: '{#SNMPVALUE}:'
          master_item:
            key: vm.memory.walk
          preprocessing:
            - type: SNMP_WALK_TO_JSON
              parameters:
                - '{#SNMPVALUE}'
                - 1.3.6.1.4.1.9.9.48.1.1.1.2
                - '0'
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
        - uuid: 07c989830d4c42a795efa9b1776ca7e7
          name: psu_discovery
          type: DEPENDENT
          key: psu.discovery
          delay: '0'
          lifetime_type: DELETE_IMMEDIATELY
          lifetime: '0'
          description: 'The table of power supply status maintained by the environmental monitor card.'
          item_prototypes:
            - uuid: 9f40bfaacaa8439598c1b47622b42341
              name: power_supply_status
              type: DEPENDENT
              key: 'sensor.psu.status[ciscoEnvMonSupplyState.{#SNMPINDEX}]'
              delay: '0'
              history: 2w
              trends: '0'
              description: 'MIB: CISCO-ENVMON-MIB'
              valuemap:
                name: 'CISCO-ENVMON-MIB::CiscoEnvMonState'
              preprocessing:
                - type: SNMP_WALK_VALUE
                  parameters:
                    - '1.3.6.1.4.1.9.9.13.1.5.1.3.{#SNMPINDEX}'
                    - '0'
                - type: JAVASCRIPT
                  parameters:
                    - |
                      if (value != 2 && value !=1) {
                          return 2
                      } else if (value == 2){
                          return 2
                      } else {
                          return 1
                      }
              master_item:
                key: sensor.psu.walk
              tags:
                - tag: power
                  value: '{#SENSOR_INFO}'
              trigger_prototypes:
                - uuid: 0f90aa59d1f9443f8ac6d5bc19b256a8
                  expression: 'min(/template_cisco_wlan_basic/sensor.psu.status[ciscoEnvMonSupplyState.{#SNMPINDEX}],#3)>1'
                  name: power_supply_is_in_critical_state
                  opdata: 'Current state: {ITEM.LASTVALUE1}'
                  priority: AVERAGE
                  description: 'Please check the power supply unit for errors'
                  manual_close: 'YES'
                  tags:
                    - tag: power
                      value: '{#SENSOR_INFO}'
          master_item:
            key: sensor.psu.walk
          preprocessing:
            - type: SNMP_WALK_TO_JSON
              parameters:
                - '{#SENSOR_INFO}'
                - 1.3.6.1.4.1.9.9.13.1.5.1.2
                - '0'
              error_handler: DISCARD_VALUE
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
        - uuid: aa8192e2dc0941b3b99f103bfca8473d
          name: temperature_discovery
          type: DEPENDENT
          key: temperature.discovery
          delay: '0'
          lifetime_type: DELETE_IMMEDIATELY
          lifetime: '0'
          description: |
            Discovery of ciscoEnvMonTemperatureTable (ciscoEnvMonTemperatureDescr), a table of ambient temperature status
            maintained by the environmental monitor.
          item_prototypes:
            - uuid: 72dc86d8b7ba4608bcb6900f32314b94
              name: temperature_status
              type: DEPENDENT
              key: 'sensor.temp.status[ciscoEnvMonTemperatureState.{#SNMPINDEX}]'
              delay: '0'
              history: 1w
              trends: '0'
              description: |
                MIB: CISCO-ENVMON-MIB
                The current state of the test point being instrumented.
              valuemap:
                name: 'CISCO-ENVMON-MIB::CiscoEnvMonState'
              preprocessing:
                - type: SNMP_WALK_VALUE
                  parameters:
                    - '1.3.6.1.4.1.9.9.13.1.3.1.6.{#SNMPINDEX}'
                    - '0'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 3m
              master_item:
                key: sensor.temp.walk
              tags:
                - tag: entity
                  value: '{#SNMPVALUE}'
            - uuid: b3463127638449f39c5f6b349d913bc0
              name: temperature
              type: DEPENDENT
              key: 'sensor.temp.value[ciscoEnvMonTemperatureValue.{#SNMPINDEX}]'
              delay: '0'
              history: 7d
              value_type: FLOAT
              trends: '0'
              units: °C
              description: |
                MIB: CISCO-ENVMON-MIB
                The current measurement of the test point being instrumented.
              preprocessing:
                - type: SNMP_WALK_VALUE
                  parameters:
                    - '1.3.6.1.4.1.9.9.13.1.3.1.3.{#SNMPINDEX}'
                    - '0'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 3m
              master_item:
                key: sensor.temp.walk
              tags:
                - tag: entity
                  value: '{#SNMPVALUE}'
          trigger_prototypes:
            - uuid: 27c5dd1ed6fb44f5981f06b70e46b1f8
              expression: |
                avg(/template_cisco_wlan_basic/sensor.temp.value[ciscoEnvMonTemperatureValue.{#SNMPINDEX}],5m)>{$TEMP_CRIT:"{#SNMPVALUE}"}
                or
                last(/template_cisco_wlan_basic/sensor.temp.status[ciscoEnvMonTemperatureState.{#SNMPINDEX}])={$TEMP_CRIT_STATUS}
                or
                last(/template_cisco_wlan_basic/sensor.temp.status[ciscoEnvMonTemperatureState.{#SNMPINDEX}])={$TEMP_DISASTER_STATUS}
              recovery_mode: RECOVERY_EXPRESSION
              recovery_expression: 'max(/template_cisco_wlan_basic/sensor.temp.value[ciscoEnvMonTemperatureValue.{#SNMPINDEX}],5m)<{$TEMP_CRIT:"{#SNMPVALUE}"}-3'
              name: high_temperature
              event_name: '{#SNMPVALUE}: Temperature is above critical threshold: >{$TEMP_CRIT:"{#SNMPVALUE}"}'
              opdata: 'Current value: {ITEM.LASTVALUE1}'
              priority: HIGH
              description: 'This trigger uses temperature sensor values as well as temperature sensor status if available'
              tags:
                - tag: entity
                  value: '{#SNMPVALUE}'
            - uuid: 6e38d89e254d4afd8373323d1b21c5b8
              expression: |
                avg(/template_cisco_wlan_basic/sensor.temp.value[ciscoEnvMonTemperatureValue.{#SNMPINDEX}],5m)>{$TEMP_WARN:"{#SNMPVALUE}"}
                or
                last(/template_cisco_wlan_basic/sensor.temp.status[ciscoEnvMonTemperatureState.{#SNMPINDEX}])={$TEMP_WARN_STATUS}
              recovery_mode: RECOVERY_EXPRESSION
              recovery_expression: 'max(/template_cisco_wlan_basic/sensor.temp.value[ciscoEnvMonTemperatureValue.{#SNMPINDEX}],5m)<{$TEMP_WARN:"{#SNMPVALUE}"}-3'
              name: high_temperature
              event_name: '{#SNMPVALUE}: Temperature is above warning threshold: >{$TEMP_WARN:"{#SNMPVALUE}"}'
              opdata: 'Current value: {ITEM.LASTVALUE1}'
              priority: WARNING
              description: 'This trigger uses temperature sensor values as well as temperature sensor status if available'
              dependencies:
                - name: high_temperature
                  expression: |
                    avg(/template_cisco_wlan_basic/sensor.temp.value[ciscoEnvMonTemperatureValue.{#SNMPINDEX}],5m)>{$TEMP_CRIT:"{#SNMPVALUE}"}
                    or
                    last(/template_cisco_wlan_basic/sensor.temp.status[ciscoEnvMonTemperatureState.{#SNMPINDEX}])={$TEMP_CRIT_STATUS}
                    or
                    last(/template_cisco_wlan_basic/sensor.temp.status[ciscoEnvMonTemperatureState.{#SNMPINDEX}])={$TEMP_DISASTER_STATUS}
                  recovery_expression: 'max(/template_cisco_wlan_basic/sensor.temp.value[ciscoEnvMonTemperatureValue.{#SNMPINDEX}],5m)<{$TEMP_CRIT:"{#SNMPVALUE}"}-3'
              tags:
                - tag: entity
                  value: '{#SNMPVALUE}'
          master_item:
            key: sensor.temp.walk
          preprocessing:
            - type: SNMP_WALK_TO_JSON
              parameters:
                - '{#SNMPVALUE}'
                - 1.3.6.1.4.1.9.9.13.1.3.1.2
                - '0'
              error_handler: DISCARD_VALUE
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
      macros:
        - macro: '{$CPU.USAGE.HIGH}'
          value: '90'
        - macro: '{$ICMP_LOSS_WARN}'
          value: '20'
        - macro: '{$ICMP_RESPONSE_TIME_WARN}'
          value: '0.15'
        - macro: '{$MEMORY.UTIL.HIGH}'
          value: '90'
        - macro: '{$SNMP.TIMEOUT}'
          value: 5m
        - macro: '{$TEMP_CRIT}'
          value: '75'
        - macro: '{$TEMP_CRIT_LOW}'
          value: '5'
        - macro: '{$TEMP_CRIT_STATUS}'
          value: '3'
        - macro: '{$TEMP_DISASTER_STATUS}'
          value: '4'
        - macro: '{$TEMP_WARN}'
          value: '68'
        - macro: '{$TEMP_WARN_STATUS}'
          value: '2'
      valuemaps:
        - uuid: fbb2a921b0254aa6b0282390490ca063
          name: ap_status
          mappings:
            - value: '1'
              newvalue: up
            - value: '2'
              newvalue: down
        - uuid: 10793c77e95f4bb3b76d945850df7964
          name: 'CISCO-ENVMON-MIB::CiscoEnvMonState'
          mappings:
            - value: '1'
              newvalue: normal
            - value: '2'
              newvalue: warning
            - value: '3'
              newvalue: critical
            - value: '4'
              newvalue: shutdown
            - value: '5'
              newvalue: notPresent
            - value: '6'
              newvalue: notFunctioning
        - uuid: 7b483641ff34423db00afabe4ea77db2
          name: entity_status
          mappings:
            - value: '1'
              newvalue: normal
            - value: '2'
              newvalue: abnormal
        - uuid: 63f64cc05e90441fa92087f71d5f18f9
          name: 'EtherLike-MIB::dot3StatsDuplexStatus'
          mappings:
            - value: '1'
              newvalue: unknown
            - value: '2'
              newvalue: halfDuplex
            - value: '3'
              newvalue: fullDuplex
        - uuid: 839dedcbf6954408a06472a3a837fef9
          name: 'IF-MIB::ifOperStatus'
          mappings:
            - value: '1'
              newvalue: up
            - value: '2'
              newvalue: down
            - value: '4'
              newvalue: unknown
            - value: '5'
              newvalue: dormant
            - value: '6'
              newvalue: notPresent
            - value: '7'
              newvalue: lowerLayerDown
        - uuid: 94128b82ec574522b5f1447edabaa7e1
          name: 'Service state'
          mappings:
            - value: '0'
              newvalue: Down
            - value: '1'
              newvalue: Up
        - uuid: 2ce787e6c02c483092b14ee642a955bd
          name: zabbix.host.available
          mappings:
            - value: '0'
              newvalue: 'not available'
            - value: '1'
              newvalue: available
            - value: '2'
              newvalue: unknown
