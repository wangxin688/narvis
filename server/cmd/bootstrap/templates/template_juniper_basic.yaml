zabbix_export:
  version: '7.0'
  template_groups:
    - uuid: 1877cc163d5b46e1a8121d91b1dbe38e
      name: Templates/narvis
  templates:
    - uuid: 6178ebefc2f84ac989f6b7fcf01210af
      template: template_juniper_basic
      name: template_juniper_basic
      description: |
        Template Net Juniper
        
        MIBs used:
        EtherLike-MIB
        JUNIPER-ALARM-MIB
        HOST-RESOURCES-MIB
        SNMPv2-MIB
        JUNIPER-MIB
        IF-MIB
        
        Generated by official Zabbix template tool "Templator"
      templates:
        - name: template_interface_basic
      groups:
        - name: Templates/narvis
      items:
        - uuid: d58fcfa022294e5aa83b9dde2a7e0c97
          name: icmp_ping
          type: SIMPLE
          key: icmpping
          history: 7d
          trends: '0'
          valuemap:
            name: 'Service state'
          triggers:
            - uuid: a11fc2adb74349a4ae5b79a726ad725f
              expression: 'max(/template_juniper_basic/icmpping,#3)=0'
              name: unavailable_by_icmp_ping
              priority: HIGH
              description: 'Last three attempts returned timeout.  Please check device connectivity.'
              manual_close: 'YES'
        - uuid: 864a1f6ea13b47828a49e5354f6b679e
          name: icmp_loss
          type: SIMPLE
          key: icmppingloss
          history: 7d
          value_type: FLOAT
          trends: '0'
          units: '%'
          triggers:
            - uuid: 73a010b1f3f74b77979d6ed7485eabef
              expression: 'min(/template_juniper_basic/icmppingloss,5m)>{$ICMP_LOSS_WARN} and min(/template_juniper_basic/icmppingloss,5m)<100'
              name: high_icmp_ping_loss
              opdata: 'Loss: {ITEM.LASTVALUE1}'
              priority: WARNING
              manual_close: 'YES'
              dependencies:
                - name: unavailable_by_icmp_ping
                  expression: 'max(/template_juniper_basic/icmpping,#3)=0'
        - uuid: 93caaeefb2fc4119be6d7f1ead5d68bb
          name: icmp_response_time
          type: SIMPLE
          key: icmppingsec
          history: 7d
          value_type: FLOAT
          trends: '0'
          units: s
          triggers:
            - uuid: 80a08cd126cc4d8396024550de9e309e
              expression: 'avg(/template_juniper_basic/icmppingsec,5m)>{$ICMP_RESPONSE_TIME_WARN}'
              name: high_icmp_ping_response_time
              opdata: 'Value: {ITEM.LASTVALUE1}'
              priority: WARNING
              manual_close: 'YES'
              dependencies:
                - name: high_icmp_ping_loss
                  expression: 'min(/template_juniper_basic/icmppingloss,5m)>{$ICMP_LOSS_WARN} and min(/template_juniper_basic/icmppingloss,5m)<100'
                - name: unavailable_by_icmp_ping
                  expression: 'max(/template_juniper_basic/icmpping,#3)=0'
        - uuid: b0ef13bd179b45588deea6728c1bd6c5
          name: uptime
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.3.0
          key: 'system.net.uptime[sysUpTime.0]'
          delay: 3m
          history: 7d
          trends: '0'
          units: uptime
          description: |
            MIB: SNMPv2-MIB
            The time (in hundredths of a second) since the network management portion of the system was last re-initialized.
          preprocessing:
            - type: MULTIPLIER
              parameters:
                - '0.01'
        - uuid: 9b2927239d1d4d2299bcac738e51f98a
          name: snmp_agent_availability
          type: INTERNAL
          key: 'zabbix[host,snmp,available]'
          history: 7d
          trends: '0'
          description: |
            Availability of SNMP checks on the host. The value of this item corresponds to availability icons in the host list.
            Possible value:
            0 - not available
            1 - available
            2 - unknown
          valuemap:
            name: zabbix.host.available
          preprocessing:
            - type: JAVASCRIPT
              parameters:
                - |
                  if (value == 2) {
                     return 0
                  } else {
                     return value
                  }
                  }
          triggers:
            - uuid: b55dfdea66374b98a47fc7a22274fc5c
              expression: 'max(/template_juniper_basic/zabbix[host,snmp,available],{$SNMP.TIMEOUT})=0'
              name: no_snmp_data_collection
              opdata: 'Current state: {ITEM.LASTVALUE1}'
              priority: WARNING
              description: 'SNMP is not available for polling. Please check device connectivity and SNMP settings.'
              manual_close: 'YES'
              dependencies:
                - name: unavailable_by_icmp_ping
                  expression: 'max(/template_juniper_basic/icmpping,#3)=0'
      discovery_rules:
        - uuid: 41ffc6132714414b980da4d462f8f12c
          name: cpu_and_memory_discovery
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#SNMPVALUE},1.3.6.1.4.1.2636.3.1.13.1.5]'
          key: jnxOperatingTable.discovery
          delay: 1h
          filter:
            conditions:
              - macro: '{#SNMPVALUE}'
                value: 'Routing Engine.*'
                formulaid: A
          lifetime_type: DELETE_IMMEDIATELY
          lifetime: '0'
          description: |
            Scanning JUNIPER-MIB::jnxOperatingTable for CPU and Memory
            http://kb.juniper.net/InfoCenter/index?page=content&id=KB17526&actp=search. Filter limits results to Routing Engines
          item_prototypes:
            - uuid: d07bb16589354c80afaadcf4b35b16ba
              name: cpu_utilization
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.2636.3.1.13.1.8.{#SNMPINDEX}'
              key: 'system.cpu.util[jnxOperatingCPU.{#SNMPINDEX}]'
              delay: 3m
              history: 7d
              value_type: FLOAT
              trends: '0'
              units: '%'
              description: |
                MIB: JUNIPER-MIB
                The CPU utilization in percentage of this subject. Zero if unavailable or inapplicable.
                Reference: http://kb.juniper.net/library/CUSTOMERSERVICE/GLOBAL_JTAC/BK26199/SRX%20SNMP%20Monitoring%20Guide_v1.1.pdf
              tags:
                - tag: cpu
                  value: '{#SNMPVALUE}'
              trigger_prototypes:
                - uuid: 6efa1756544b4cd28ef1ab356f2e17f7
                  expression: 'min(/template_juniper_basic/system.cpu.util[jnxOperatingCPU.{#SNMPINDEX}],5m)>{$CPU.UTIL.CRIT}'
                  name: high_cpu_utilization
                  event_name: '{#SNMPVALUE}: High CPU utilization (over {$CPU.UTIL.CRIT}% for 5m)'
                  opdata: 'Current utilization: {ITEM.LASTVALUE1}'
                  priority: WARNING
                  description: 'The CPU utilization is too high. The system might be slow to respond.'
                  manual_close: 'YES'
            - uuid: 5ac91dd86aa148fe830d3ed94ed2a8ad
              name: memory_utlization
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.2636.3.1.13.1.11.{#SNMPINDEX}'
              key: 'vm.memory.util[jnxOperatingBuffer.{#SNMPINDEX}]'
              delay: 3m
              history: 7d
              value_type: FLOAT
              trends: '0'
              units: '%'
              description: |
                MIB: JUNIPER-MIB
                The buffer pool utilization in percentage of this subject.  Zero if unavailable or inapplicable.
                Reference: http://kb.juniper.net/library/CUSTOMERSERVICE/GLOBAL_JTAC/BK26199/SRX%20SNMP%20Monitoring%20Guide_v1.1.pdf
              tags:
                - tag: entity
                  value: '{#SNMPVALUE}'
              trigger_prototypes:
                - uuid: 928f2b6c3b924fe2b63e03987f4b59b4
                  expression: 'min(/template_juniper_basic/vm.memory.util[jnxOperatingBuffer.{#SNMPINDEX}],5m)>{$MEMORY.UTIL.MAX}'
                  name: high_memory_utilization
                  event_name: '{#SNMPVALUE}: High memory utilization (>{$MEMORY.UTIL.MAX}% for 5m)'
                  priority: AVERAGE
                  description: 'The system is running out of free memory.'
                  manual_close: 'YES'
        - uuid: 162e53fa3a3147e5817cb5a6d1dc54ee
          name: fan_discovery
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#SNMPVALUE},1.3.6.1.4.1.2636.3.1.13.1.5.4]'
          key: jnxOperatingTable.discovery.fans
          delay: 1h
          lifetime_type: DELETE_IMMEDIATELY
          lifetime: '0'
          description: 'Scanning JUNIPER-MIB::jnxOperatingTable for Fans'
          item_prototypes:
            - uuid: ed9d25c8abfc44bda6950a2ec47fab44
              name: fan_status
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.2636.3.1.13.1.6.4.{#SNMPINDEX}'
              key: 'sensor.fan.status[jnxOperatingState.4.{#SNMPINDEX}]'
              delay: 3m
              history: 7d
              trends: '0'
              description: 'MIB: JUNIPER-MIB'
              valuemap:
                name: 'JUNIPER-ALARM-MIB::jnxOperatingState'
              tags:
                - tag: fan
                  value: '{#SNMPVALUE}'
              trigger_prototypes:
                - uuid: 4e13632c3d7d4b91b900e7a1ddbaff4d
                  expression: 'count(/template_juniper_basic/sensor.fan.status[jnxOperatingState.4.{#SNMPINDEX}],#1,"eq","{$FAN_CRIT_STATUS}")=1'
                  name: fan_status_abnormal
                  opdata: 'Current state: {ITEM.LASTVALUE1}'
                  priority: AVERAGE
                  description: 'Please check the fan unit'
                  manual_close: 'YES'
        - uuid: 29dfc10ffec34e6da4fd6f14f3ca5f18
          name: psu_discovery
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#SNMPVALUE},1.3.6.1.4.1.2636.3.1.13.1.5.2]'
          key: jnxOperatingTable.discovery.psu
          delay: 1h
          lifetime_type: DELETE_IMMEDIATELY
          lifetime: '0'
          description: 'Scanning JUNIPER-MIB::jnxOperatingTable for Power Supplies'
          item_prototypes:
            - uuid: 0e906f3b40ce49f592d6592b2dd56017
              name: power_supply_status
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.2636.3.1.13.1.6.2.{#SNMPINDEX}'
              key: 'sensor.psu.status[jnxOperatingState.2.{#SNMPINDEX}]'
              delay: 3m
              history: 7d
              trends: '0'
              description: |
                MIB: JUNIPER-MIB
                If they are using DC power supplies there is a known issue on PR 1064039 where the fans do not detect the temperature correctly and fail to cool the power supply causing the shutdown to occur.
                This is fixed in Junos 13.3R7 https://forums.juniper.net/t5/Routing/PEM-0-not-OK-MX104/m-p/289644#M14122
              valuemap:
                name: 'JUNIPER-ALARM-MIB::jnxOperatingState'
              tags:
                - tag: power
                  value: '{#SNMPVALUE}'
              trigger_prototypes:
                - uuid: 3cbe940581a341d38812d5725eaa0a3c
                  expression: 'count(/template_juniper_basic/sensor.psu.status[jnxOperatingState.2.{#SNMPINDEX}],#1,"eq","{$PSU_CRIT_STATUS}")=1'
                  name: power_status_abnormal
                  opdata: 'Current state: {ITEM.LASTVALUE1}'
                  priority: AVERAGE
                  description: 'Please check the power supply unit for errors'
                  manual_close: 'YES'
        - uuid: d868b54a1da84fcd9822cb262ca38718
          name: temperature_discovery
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#SNMPVALUE},1.3.6.1.4.1.2636.3.1.13.1.7,{#SENSOR_INFO},1.3.6.1.4.1.2636.3.1.13.1.5]'
          key: jnxOperatingTable.discovery.temp
          delay: 1h
          filter:
            conditions:
              - macro: '{#SNMPVALUE}'
                value: '[^0]+'
                formulaid: A
          lifetime_type: DELETE_IMMEDIATELY
          lifetime: '0'
          description: |
            Scanning JUNIPER-MIB::jnxOperatingTable for Temperature
            http://kb.juniper.net/InfoCenter/index?page=content&id=KB17526&actp=search. Filter limits results to Routing Engines
          item_prototypes:
            - uuid: 133f4a911e244292bba0b2ad311280b8
              name: temperature
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.2636.3.1.13.1.7.{#SNMPINDEX}'
              key: 'sensor.temp.value[jnxOperatingTemp.{#SNMPINDEX}]'
              delay: 3m
              history: 7d
              value_type: FLOAT
              trends: '0'
              units: °C
              description: |
                MIB: JUNIPER-MIB
                The temperature in Celsius (degrees C) of {#SENSOR_INFO}
              tags:
                - tag: entity
                  value: '{#SENSOR_INFO}'
              trigger_prototypes:
                - uuid: f93219c1b70140ae8b3e10ec1c28af02
                  expression: 'avg(/template_juniper_basic/sensor.temp.value[jnxOperatingTemp.{#SNMPINDEX}],5m)>{$TEMP_CRIT:"{#SENSOR_INFO}"}'
                  recovery_mode: RECOVERY_EXPRESSION
                  recovery_expression: 'max(/template_juniper_basic/sensor.temp.value[jnxOperatingTemp.{#SNMPINDEX}],5m)<{$TEMP_CRIT:"{#SENSOR_INFO}"}-3'
                  name: high_temperature
                  event_name: '{#SENSOR_INFO}: Temperature is above critical threshold: >{$TEMP_CRIT:"{#SENSOR_INFO}"}'
                  opdata: 'Current value: {ITEM.LASTVALUE1}'
                  priority: HIGH
                  description: 'This trigger uses temperature sensor values as well as temperature sensor status if available'
                  manual_close: 'YES'
                - uuid: a198175a4c144540b0da07e87ff6bdc4
                  expression: 'avg(/template_juniper_basic/sensor.temp.value[jnxOperatingTemp.{#SNMPINDEX}],5m)>{$TEMP_WARN:"{#SENSOR_INFO}"}'
                  recovery_mode: RECOVERY_EXPRESSION
                  recovery_expression: 'max(/template_juniper_basic/sensor.temp.value[jnxOperatingTemp.{#SNMPINDEX}],5m)<{$TEMP_WARN:"{#SENSOR_INFO}"}-3'
                  name: high_temperature
                  event_name: '{#SENSOR_INFO}: Temperature is above warning threshold: >{$TEMP_WARN:"{#SENSOR_INFO}"}'
                  opdata: 'Current value: {ITEM.LASTVALUE1}'
                  priority: WARNING
                  description: 'This trigger uses temperature sensor values as well as temperature sensor status if available'
                  manual_close: 'YES'
                  dependencies:
                    - name: high_temperature
                      expression: 'avg(/template_juniper_basic/sensor.temp.value[jnxOperatingTemp.{#SNMPINDEX}],5m)>{$TEMP_CRIT:"{#SENSOR_INFO}"}'
                      recovery_expression: 'max(/template_juniper_basic/sensor.temp.value[jnxOperatingTemp.{#SNMPINDEX}],5m)<{$TEMP_CRIT:"{#SENSOR_INFO}"}-3'
      macros:
        - macro: '{$CPU.USAGE.HIGH}'
          value: '90'
        - macro: '{$FAN_CRIT_STATUS}'
          value: '2'
        - macro: '{$ICMP_LOSS_WARN}'
          value: '20'
        - macro: '{$ICMP_RESPONSE_TIME_WARN}'
          value: '0.15'
        - macro: '{$MEMORY.UTIL.HIGH}'
          value: '90'
        - macro: '{$SNMP.TIMEOUT}'
          value: 5m
        - macro: '{$TEMP_CRIT}'
          value: '75'
        - macro: '{$TEMP_CRIT_LOW}'
          value: '5'
        - macro: '{$TEMP_WARN}'
          value: '68'
      valuemaps:
        - uuid: 7e80905ab6c34817ab79387bc173113b
          name: 'EtherLike-MIB::dot3StatsDuplexStatus'
          mappings:
            - value: '1'
              newvalue: unknown
            - value: '2'
              newvalue: halfDuplex
            - value: '3'
              newvalue: fullDuplex
        - uuid: a12f47c922b5475fb78ab70ceccf413c
          name: 'IF-MIB::ifOperStatus'
          mappings:
            - value: '1'
              newvalue: up
            - value: '2'
              newvalue: down
            - value: '4'
              newvalue: unknown
            - value: '5'
              newvalue: dormant
            - value: '6'
              newvalue: notPresent
            - value: '7'
              newvalue: lowerLayerDown
        - uuid: 6efcd348a8c54f33b4592ab976d2919a
          name: 'JUNIPER-ALARM-MIB::jnxOperatingState'
          mappings:
            - value: '1'
              newvalue: unknown
            - value: '2'
              newvalue: running
            - value: '3'
              newvalue: ready
            - value: '4'
              newvalue: reset
            - value: '5'
              newvalue: runningAtFullSpeed
            - value: '6'
              newvalue: 'down or off'
            - value: '7'
              newvalue: standby
        - uuid: 2fd0758e4bad487ca3e75211e8e6927d
          name: 'JUNIPER-ALARM-MIB::jnxRedAlarmState'
          mappings:
            - value: '1'
              newvalue: other
            - value: '2'
              newvalue: 'off'
            - value: '3'
              newvalue: 'on - RedAlarm'
        - uuid: 8aa65bc2204b4d6d99b15d6750076d02
          name: 'Service state'
          mappings:
            - value: '0'
              newvalue: Down
            - value: '1'
              newvalue: Up
        - uuid: fa581e12639c4429b8f570883ad9d29d
          name: zabbix.host.available
          mappings:
            - value: '0'
              newvalue: 'not available'
            - value: '1'
              newvalue: available
            - value: '2'
              newvalue: unknown
