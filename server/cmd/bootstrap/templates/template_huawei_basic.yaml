zabbix_export:
  version: '7.0'
  template_groups:
    - uuid: 1877cc163d5b46e1a8121d91b1dbe38e
      name: Templates/narvis
  templates:
    - uuid: caad0f57ac4f4723a02f5bdf52bd1a1c
      template: template_huawei_basic
      name: template_huawei_basic
      description: |
        Template Net Huawei VRP
        
        MIBs used:
        EtherLike-MIB
        HUAWEI-ENTITY-EXTENT-MIB
        HOST-RESOURCES-MIB
        SNMPv2-MIB
        ENTITY-MIB
        IF-MIB
        
        Generated by official Zabbix template tool "Templator" 2.0.0
      templates:
        - name: template_interface_basic
      groups:
        - name: Templates/narvis
      items:
        - uuid: c13315ebbc264875a2cd73200db9981e
          name: icmp_ping
          type: SIMPLE
          key: icmpping
          history: 7d
          trends: '0'
          valuemap:
            name: 'Service state'
          triggers:
            - uuid: 3b02a212aee7440996dd5700006ade5b
              expression: 'max(/template_huawei_basic/icmpping,#3)=0'
              name: unavailable_by_icmp_ping
              priority: HIGH
              description: 'Last three attempts returned timeout.  Please check device connectivity.'
              manual_close: 'YES'
              tags:
                - tag: scope
                  value: availability
        - uuid: d0f3a9635bf7407699c789b5893f9e77
          name: icmp_loss
          type: SIMPLE
          key: icmppingloss
          history: 7d
          value_type: FLOAT
          trends: '0'
          units: '%'
          triggers:
            - uuid: bb24f3eb15c64262af7aadc08d2df848
              expression: 'min(/template_huawei_basic/icmppingloss,5m)>{$ICMP_LOSS_WARN} and min(/template_huawei_basic/icmppingloss,5m)<100'
              name: high_icmp_ping_loss
              opdata: 'Loss: {ITEM.LASTVALUE1}'
              priority: WARNING
              manual_close: 'YES'
              dependencies:
                - name: unavailable_by_icmp_ping
                  expression: 'max(/template_huawei_basic/icmpping,#3)=0'
        - uuid: fea1f84da8944a5096f2a53d86a4488f
          name: icmp_response_time
          type: SIMPLE
          key: icmppingsec
          history: 7d
          value_type: FLOAT
          trends: '0'
          units: s
          triggers:
            - uuid: 9b8f8457bfce43ee9a64b2ecf9135957
              expression: 'avg(/template_huawei_basic/icmppingsec,5m)>{$ICMP_RESPONSE_TIME_WARN}'
              name: high_icmp_ping_response_time
              opdata: 'Value: {ITEM.LASTVALUE1}'
              priority: WARNING
              manual_close: 'YES'
              dependencies:
                - name: high_icmp_ping_loss
                  expression: 'min(/template_huawei_basic/icmppingloss,5m)>{$ICMP_LOSS_WARN} and min(/template_huawei_basic/icmppingloss,5m)<100'
                - name: unavailable_by_icmp_ping
                  expression: 'max(/template_huawei_basic/icmpping,#3)=0'
              tags:
                - tag: scope
                  value: availability
                - tag: scope
                  value: performance
        - uuid: 4a3d1a3195c447a3a3039eacdb0986d6
          name: uptime
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.3.0
          key: 'system.net.uptime[sysUpTime.0]'
          delay: 3m
          history: 7d
          trends: '0'
          units: uptime
          description: |
            MIB: SNMPv2-MIB
            The time (in hundredths of a second) since the network management portion of the system was last re-initialized.
          preprocessing:
            - type: MULTIPLIER
              parameters:
                - '0.01'
        - uuid: e9aec146bdbe46d699a7a65639c7db36
          name: snmp_agent_availability
          type: INTERNAL
          key: 'zabbix[host,snmp,available]'
          history: 7d
          trends: '0'
          description: |
            Availability of SNMP checks on the host. The value of this item corresponds to availability icons in the host list.
            Possible value:
            0 - not available
            1 - available
            2 - unknown
          valuemap:
            name: zabbix.host.available
          preprocessing:
            - type: JAVASCRIPT
              parameters:
                - |
                  if (value == 2) {
                     return 0
                  } else {
                     return value
                  }
                  }
          triggers:
            - uuid: 987b7993de644b24985823dd42aef5d1
              expression: 'max(/template_huawei_basic/zabbix[host,snmp,available],{$SNMP.TIMEOUT})=0'
              name: no_snmp_data_collection
              opdata: 'Current state: {ITEM.LASTVALUE1}'
              priority: WARNING
              description: 'SNMP is not available for polling. Please check device connectivity and SNMP settings.'
              manual_close: 'YES'
              dependencies:
                - name: unavailable_by_icmp_ping
                  expression: 'max(/template_huawei_basic/icmpping,#3)=0'
              tags:
                - tag: scope
                  value: availability
      discovery_rules:
        - uuid: 63fe1b2048e04e39bab55b6b59f23d0f
          name: fan_discovery
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#SLOT},1.3.6.1.4.1.2011.5.25.31.1.1.10.1.1,{#INDEX},1.3.6.1.4.1.2011.5.25.31.1.1.10.1.2]'
          key: discovery.fans
          delay: 1h
          lifetime_type: DELETE_IMMEDIATELY
          lifetime: '0'
          item_prototypes:
            - uuid: cc25c8b63af94fe8ae0466f539684c54
              name: fan_status
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.2011.5.25.31.1.1.10.1.7.{#SNMPINDEX}'
              key: 'sensor.fan.status[hwEntityFanState.{#SLOT}.{#INDEX}]'
              delay: 3m
              history: 1w
              trends: '0'
              description: 'MIB: HUAWEI-ENTITY-EXTENT-MIB'
              valuemap:
                name: 'HUAWEI-ENTITY-EXTENT-MIB::hwEntityFanState'
              tags:
                - tag: fan
                  value: '{#INDEX}'
                - tag: slot
                  value: '{#SLOT}'
              trigger_prototypes:
                - uuid: 6e2577553f8949c5bcb62a5425dbad46
                  expression: 'count(/template_huawei_basic/sensor.fan.status[hwEntityFanState.{#SLOT}.{#INDEX}],#1,"eq","{$FAN_CRIT_STATUS}")=1'
                  name: fan_status_abnormal
                  opdata: 'Current state: {ITEM.LASTVALUE1}'
                  priority: AVERAGE
                  description: 'Please check the fan unit'
                  manual_close: 'YES'
                  tags:
                    - tag: fan
                      value: '{#SNMPVALUE}'
        - uuid: 041d4fec087d401782f65f5888a2da9e
          name: power_supply_discovery
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#SLOT},.1.3.6.1.4.1.2011.5.25.31.1.1.18.1.1,{#INDEX},.1.3.6.1.4.1.2011.5.25.31.1.1.18.1.2]'
          key: huawei.vrp.pwr.discovery
          delay: 1h
          lifetime_type: DELETE_IMMEDIATELY
          lifetime: '0'
          item_prototypes:
            - uuid: 8836e73679e84615b0f81b8a462bad7c
              name: power_supply_status
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.2011.5.25.31.1.1.18.1.6.{#SNMPINDEX}'
              key: 'huawei.vrp.pwr.status[{#SLOT}.{#INDEX}]'
              delay: 3m
              history: 7d
              trends: '0'
              valuemap:
                name: 'Huawei VRP Pwr status'
              preprocessing:
                - type: JAVASCRIPT
                  parameters:
                    - |
                      if (value >= 2) {
                          return 2
                      } else {
                          return 1
                      }
              tags:
                - tag: power
                  value: '{#INDEX}'
                - tag: slot
                  value: '{#SLOT}'
              trigger_prototypes:
                - uuid: 3f49c934e22d4182b5648dbfe73f1841
                  expression: 'min(/template_huawei_basic/huawei.vrp.pwr.status[{#SLOT}.{#INDEX}],#3)>1'
                  recovery_mode: RECOVERY_EXPRESSION
                  recovery_expression: 'last(/template_huawei_basic/huawei.vrp.pwr.status[{#SLOT}.{#INDEX}],#1)=1'
                  name: power_status_abnormal
                  priority: WARNING
                  manual_close: 'YES'
                  tags:
                    - tag: power
                      value: '{#INDEX}'
                    - tag: slot
                      value: '{#SLOT}'
        - uuid: 4b7cfa48772f480cb051327bcf0d3237
          name: mpu_discovery
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#ENT_NAME},1.3.6.1.2.1.47.1.1.1.1.7]'
          key: mpu.discovery
          delay: 1h
          filter:
            conditions:
              - macro: '{#ENT_NAME}'
                value: '(MPU|SRU).*'
                formulaid: A
          lifetime_type: DELETE_IMMEDIATELY
          lifetime: '0'
          description: 'http://support.huawei.com/enterprise/KnowledgebaseReadAction.action?contentId=KB1000090234. Filter limits results to Main Processing Units'
          item_prototypes:
            - uuid: 289850c70ab4432b856ba9a9bce070b1
              name: temperature
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.2011.5.25.31.1.1.1.1.11.{#SNMPINDEX}'
              key: 'sensor.temp.value[hwEntityTemperature.{#SNMPINDEX}]'
              delay: 3m
              history: 7d
              value_type: FLOAT
              trends: '0'
              units: Â°C
              description: |
                MIB: HUAWEI-ENTITY-EXTENT-MIB
                The temperature for the {#SNMPVALUE}.
              tags:
                - tag: entity
                  value: '{#ENT_NAME}'
              trigger_prototypes:
                - uuid: 59f8bca073a5472ab9d4570305a9ae87
                  expression: 'avg(/template_huawei_basic/sensor.temp.value[hwEntityTemperature.{#SNMPINDEX}],5m)>{$TEMP_CRIT}'
                  recovery_mode: NONE
                  name: temperature_is_above_warning_threshold
                  event_name: '{#ENT_NAME}: Temperature is above warning threshold: >{$TEMP_WARN:"{#ENT_NAME}"}'
                  opdata: 'Current value: {ITEM.LASTVALUE1}'
                  priority: WARNING
                  description: 'This trigger uses temperature sensor values as well as temperature sensor status if available'
                  manual_close: 'YES'
                  tags:
                    - tag: entity
                      value: '{#ENT_NAME}'
            - uuid: 212fa98ca3144b858ecd128b1253326d
              name: cpu_utilization
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.2011.5.25.31.1.1.1.1.5.{#SNMPINDEX}'
              key: 'system.cpu.util[hwEntityCpuUsage.{#SNMPINDEX}]'
              delay: 3m
              history: 7d
              value_type: FLOAT
              trends: '0'
              units: '%'
              description: |
                MIB: HUAWEI-ENTITY-EXTENT-MIB
                The CPU usage for this entity. Generally, the CPU usage will calculate the overall CPU usage on the entity, and itis not sensible with the number of CPU on the entity.
                Reference: http://support.huawei.com/enterprise/KnowledgebaseReadAction.action?contentId=KB1000090234
              tags:
                - tag: cpu
                  value: '{#ENT_NAME}'
              trigger_prototypes:
                - uuid: dfa899fe989349cab6d4d4acfa6e4e4f
                  expression: 'min(/template_huawei_basic/system.cpu.util[hwEntityCpuUsage.{#SNMPINDEX}],5m)>{$CPU.USAGE.HIGH}'
                  name: high_cpu_utilization
                  event_name: '{#ENT_NAME}: High CPU utilization (over {$CPU.USAGE.HIGH}% for 5m)'
                  opdata: 'Current utilization: {ITEM.LASTVALUE1}'
                  priority: WARNING
                  description: 'The CPU utilization is too high. The system might be slow to respond.'
                  manual_close: 'YES'
                  tags:
                    - tag: entity
                      value: '{#ENT_NAME}'
            - uuid: 8e4c8f89412d4f35a80dedd665081d28
              name: memory_utilization
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.2011.5.25.31.1.1.1.1.7.{#SNMPINDEX}'
              key: 'vm.memory.util[hwEntityMemUsage.{#SNMPINDEX}]'
              delay: 3m
              history: 7d
              value_type: FLOAT
              trends: '0'
              units: '%'
              description: |
                MIB: HUAWEI-ENTITY-EXTENT-MIB
                The memory usage for the entity. This object indicates what percent of memory are used.
                Reference: http://support.huawei.com/enterprise/KnowledgebaseReadAction.action?contentId=KB1000090234
              tags:
                - tag: entity
                  value: '{#ENT_NAME}'
              trigger_prototypes:
                - uuid: 54af61d29fc7416d8f31c56f826e9803
                  expression: 'min(/template_huawei_basic/vm.memory.util[hwEntityMemUsage.{#SNMPINDEX}],5m)>{$MEMORY.UTIL.HIGH}'
                  name: high_memory_utilization
                  event_name: '{#ENT_NAME}: High memory utilization (>{$MEMORY.UTIL.HIGH}% for 5m)'
                  priority: AVERAGE
                  description: 'The system is running out of free memory.'
                  manual_close: 'YES'
                  tags:
                    - tag: entity
                      value: '{#ENT_NAME}'
          graph_prototypes:
            - uuid: 3ffc329647844ab1b7649bb287daef3a
              name: '{#ENT_NAME}: CPU utilization'
              ymin_type_1: FIXED
              ymax_type_1: FIXED
              graph_items:
                - drawtype: GRADIENT_LINE
                  color: 199C0D
                  item:
                    host: template_huawei_basic
                    key: 'system.cpu.util[hwEntityCpuUsage.{#SNMPINDEX}]'
              discover: NO_DISCOVER
            - uuid: bd64b1d0aa2d44f7aaf4d9367b344d3b
              name: '{#ENT_NAME}: Memory utilization'
              ymin_type_1: FIXED
              ymax_type_1: FIXED
              graph_items:
                - drawtype: GRADIENT_LINE
                  color: 199C0D
                  item:
                    host: template_huawei_basic
                    key: 'vm.memory.util[hwEntityMemUsage.{#SNMPINDEX}]'
              discover: NO_DISCOVER
      macros:
        - macro: '{$CPU.USAGE.HIGH}'
          value: '90'
        - macro: '{$FAN_CRIT_STATUS}'
          value: '2'
        - macro: '{$ICMP_LOSS_WARN}'
          value: '20'
        - macro: '{$ICMP_RESPONSE_TIME_WARN}'
          value: '0.15'
        - macro: '{$MEMORY.UTIL.HIGH}'
          value: '90'
        - macro: '{$SNMP.TIMEOUT}'
          value: 5m
        - macro: '{$TEMP_CRIT}'
          value: '75'
        - macro: '{$TEMP_CRIT_LOW}'
          value: '5'
        - macro: '{$TEMP_WARN}'
          value: '68'
      valuemaps:
        - uuid: b21e1ddb538c452ebb0fa186e89eb248
          name: entity_status
          mappings:
            - value: '1'
              newvalue: normal
            - value: '2'
              newvalue: abnormal
        - uuid: 17f4ba3055b442c6858b47b116e8e2ce
          name: 'EtherLike-MIB::dot3StatsDuplexStatus'
          mappings:
            - value: '1'
              newvalue: unknown
            - value: '2'
              newvalue: halfDuplex
            - value: '3'
              newvalue: fullDuplex
        - uuid: aee65b25c43345c2942c81c8458d44c6
          name: 'HUAWEI-ENTITY-EXTENT-MIB::hwEntityFanState'
          mappings:
            - value: '1'
              newvalue: normal
            - value: '2'
              newvalue: abnormal
        - uuid: 2e14f016a05e408389481647c2634bf1
          name: 'Huawei VRP Pwr status'
          mappings:
            - value: '1'
              newvalue: Supply
            - value: '2'
              newvalue: NotSupply
            - value: '3'
              newvalue: Sleep
            - value: '4'
              newvalue: unknown
        - uuid: 09ba92da17b541df9bf967ded1159a07
          name: 'IF-MIB::ifOperStatus'
          mappings:
            - value: '1'
              newvalue: up
            - value: '2'
              newvalue: down
            - value: '4'
              newvalue: unknown
            - value: '5'
              newvalue: dormant
            - value: '6'
              newvalue: notPresent
            - value: '7'
              newvalue: lowerLayerDown
        - uuid: 73d3348b1624452b84dbe03fe06c8880
          name: 'Service state'
          mappings:
            - value: '0'
              newvalue: Down
            - value: '1'
              newvalue: Up
        - uuid: c74466de0d54430e830ed5f7a0ed69be
          name: zabbix.host.available
          mappings:
            - value: '0'
              newvalue: 'not available'
            - value: '1'
              newvalue: available
            - value: '2'
              newvalue: unknown
