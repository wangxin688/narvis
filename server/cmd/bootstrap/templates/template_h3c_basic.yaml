zabbix_export:
  version: '7.0'
  template_groups:
    - uuid: 1877cc163d5b46e1a8121d91b1dbe38e
      name: Templates/narvis
  templates:
    - uuid: 4910e7d6116544bda2a860f072db69c5
      template: template_h3c_basic
      name: template_h3c_basic
      description: |
        Template Net HP Comware (HH3C)
        
        MIBs used:
        EtherLike-MIB
        HOST-RESOURCES-MIB
        SNMPv2-MIB
        ENTITY-MIB
        HH3C-ENTITY-EXT-MIB
        IF-MIB
        
        Known Issues:
        
          Description: No temperature sensors. All entities of them return 0 for HH3C-ENTITY-EXT-MIB::hh3cEntityExtTemperature
          Version: 1910-48 Switch Software Version 5.20.99, Release 1116 Copyright(c)2010-2016 Hewlett Packard Enterprise Development LP
          Device: HP 1910-48
        
        Generated by official Zabbix template tool "Templator"
      templates:
        - name: template_interface_basic
      groups:
        - name: Templates/narvis
      items:
        - uuid: b7f2ffcc9a394c1596ca5464175c2a7d
          name: icmp_ping
          type: SIMPLE
          key: icmpping
          history: 7d
          trends: '0'
          valuemap:
            name: 'Service state'
          triggers:
            - uuid: 91780e6afe9d42a090b2a3eef1053bb1
              expression: 'max(/template_h3c_basic/icmpping,#3)=0'
              name: unavailable_by_icmp_ping
              priority: HIGH
              description: 'Last three attempts returned timeout.  Please check device connectivity.'
              manual_close: 'YES'
              tags:
                - tag: scope
                  value: availability
        - uuid: 243183032a384a56a782741f3e36d035
          name: icmp_loss
          type: SIMPLE
          key: icmppingloss
          history: 7d
          value_type: FLOAT
          trends: '0'
          units: '%'
          triggers:
            - uuid: 12d5fd82c3c0429ca6417e6c293597ca
              expression: 'min(/template_h3c_basic/icmppingloss,5m)>{$ICMP_LOSS_WARN} and min(/template_h3c_basic/icmppingloss,5m)<100'
              name: high_icmp_ping_loss
              opdata: 'Loss: {ITEM.LASTVALUE1}'
              priority: WARNING
              manual_close: 'YES'
              dependencies:
                - name: unavailable_by_icmp_ping
                  expression: 'max(/template_h3c_basic/icmpping,#3)=0'
        - uuid: 39c3ad01e2924bdfbe66b25abbfef6b6
          name: icmp_response_time
          type: SIMPLE
          key: icmppingsec
          history: 7d
          value_type: FLOAT
          trends: '0'
          units: s
          triggers:
            - uuid: bec1fd3f23df41db99c88626d0138835
              expression: 'avg(/template_h3c_basic/icmppingsec,5m)>{$ICMP_RESPONSE_TIME_WARN}'
              name: high_icmp_ping_response_time
              opdata: 'Value: {ITEM.LASTVALUE1}'
              priority: WARNING
              manual_close: 'YES'
              dependencies:
                - name: high_icmp_ping_loss
                  expression: 'min(/template_h3c_basic/icmppingloss,5m)>{$ICMP_LOSS_WARN} and min(/template_h3c_basic/icmppingloss,5m)<100'
                - name: unavailable_by_icmp_ping
                  expression: 'max(/template_h3c_basic/icmpping,#3)=0'
              tags:
                - tag: scope
                  value: availability
                - tag: scope
                  value: performance
        - uuid: 48ba370fc79747e5b87827b2a89d218a
          name: uptime
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.3.0
          key: 'system.net.uptime[sysUpTime.0]'
          delay: 3m
          history: 7d
          trends: '0'
          units: uptime
          description: |
            MIB: SNMPv2-MIB
            The time (in hundredths of a second) since the network management portion of the system was last re-initialized.
          preprocessing:
            - type: MULTIPLIER
              parameters:
                - '0.01'
        - uuid: 2a2a0b97f2bd46788ea2208ea8cefb0a
          name: snmp_agent_availability
          type: INTERNAL
          key: 'zabbix[host,snmp,available]'
          history: 7d
          trends: '0'
          description: |
            Availability of SNMP checks on the host. The value of this item corresponds to availability icons in the host list.
            Possible value:
            0 - not available
            1 - available
            2 - unknown
          valuemap:
            name: zabbix.host.available
          preprocessing:
            - type: JAVASCRIPT
              parameters:
                - |
                  if (value == 2) {
                     return 0
                  } else {
                     return value
                  }
                  }
          triggers:
            - uuid: 797f95f7696449e597a2c4794af5a481
              expression: 'max(/template_h3c_basic/zabbix[host,snmp,available],{$SNMP.TIMEOUT})=0'
              name: no_snmp_data_collection
              opdata: 'Current state: {ITEM.LASTVALUE1}'
              priority: WARNING
              description: 'SNMP is not available for polling. Please check device connectivity and SNMP settings.'
              manual_close: 'YES'
              dependencies:
                - name: unavailable_by_icmp_ping
                  expression: 'max(/template_h3c_basic/icmpping,#3)=0'
              tags:
                - tag: scope
                  value: availability
      discovery_rules:
        - uuid: f27956645f4649ab9a97e83fe09e37e4
          name: fan_discovery
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#ENT_CLASS},1.3.6.1.2.1.47.1.1.1.1.5,{#ENT_NAME},1.3.6.1.2.1.47.1.1.1.1.7,{#ENT_DESCR},1.3.6.1.2.1.47.1.1.1.1.2]'
          key: fan.discovery
          delay: 1h
          filter:
            conditions:
              - macro: '{#ENT_CLASS}'
                value: '7'
                formulaid: A
          lifetime_type: DELETE_IMMEDIATELY
          lifetime: '0'
          description: 'Discovering all entities of PhysicalClass - 7: fan(7)'
          item_prototypes:
            - uuid: 938d7b7bcb3043c99488e8a42033715c
              name: fan_status
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.25506.2.6.1.1.1.1.19.{#SNMPINDEX}'
              key: 'sensor.fan.status[hh3cEntityExtErrorStatus.{#SNMPINDEX}]'
              delay: 3m
              history: 7d
              trends: '0'
              description: |
                MIB: HH3C-ENTITY-EXT-MIB
                Indicate the error state of this entity object.
                fanError(41) means that the fan stops working.
                
                notSupported(1),
                normal(2),
                postFailure(3),
                entityAbsent(4),
                poeError(11),
                stackError(21),
                stackPortBlocked(22),
                stackPortFailed(23),
                sfpRecvError(31),
                sfpSendError(32),
                sfpBothError(33),
                sfpRecvExceedUpperLimit(34),
                sfpRecvBelowLowerLimit(35),
                sfpSendExceedUpperLimit(36),
                sfpSendBelowLowerLimit(37),
                fanError(41),
                psuError(51),
                rpsError(61),
                moduleFaulty(71),
                sensorError(81),
                hardwareFaulty(91)
              valuemap:
                name: entity_status
              preprocessing:
                - type: JAVASCRIPT
                  parameters:
                    - |
                      if (value != 2) {
                          return 2
                      } else {
                          return 1
                      }
              tags:
                - tag: entity
                  value: '{#ENT_NAME}'
              trigger_prototypes:
                - uuid: b1830da5c80d4e189607c72399d3a0ed
                  expression: 'min(/template_h3c_basic/sensor.fan.status[hh3cEntityExtErrorStatus.{#SNMPINDEX}],#3)>1'
                  name: fan_is_in_critical_state
                  opdata: 'Current state: {ITEM.LASTVALUE1}'
                  priority: AVERAGE
                  description: 'Please check the fan unit'
                  manual_close: 'YES'
                  tags:
                    - tag: entity
                      value: '{#ENT_NAME}'
        - uuid: f58455ebd42146fabb39230c8cfca069
          name: module_discovery
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#SNMPVALUE},1.3.6.1.2.1.47.1.1.1.1.2,{#MODULE_NAME},1.3.6.1.2.1.47.1.1.1.1.7]'
          key: module.discovery
          delay: 1h
          filter:
            evaltype: OR
            conditions:
              - macro: '{#SNMPVALUE}'
                value: '(Fabric|FABRIC) (.+) (Module|MODULE)'
                formulaid: A
              - macro: '{#SNMPVALUE}'
                value: '^(MODULE|Module) (LEVEL|level)1$'
                formulaid: B
          lifetime_type: DELETE_IMMEDIATELY
          lifetime: '0'
          description: 'Filter limits results to ''Module level1'' or Fabric Modules'
          item_prototypes:
            - uuid: 7bd9642a91bc4c8d90a515e9a26dece5
              name: cpu_utilization
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.25506.2.6.1.1.1.1.6.{#SNMPINDEX}'
              key: 'system.cpu.util[hh3cEntityExtCpuUsage.{#SNMPINDEX}]'
              delay: 3m
              history: 7d
              value_type: FLOAT
              trends: '0'
              units: '%'
              description: |
                MIB: HH3C-ENTITY-EXT-MIB
                The CPU usage for this entity. Generally, the CPU usage
                will calculate the overall CPU usage on the entity, and it
                is not sensible with the number of CPU on the entity
              tags:
                - tag: entity
                  value: '{#MODULE_NAME}'
              trigger_prototypes:
                - uuid: 9afaa2d2102848e8848c7cfb2ce49fd2
                  expression: 'min(/template_h3c_basic/system.cpu.util[hh3cEntityExtCpuUsage.{#SNMPINDEX}],5m)>{$CPU.USAGE.HIGH}'
                  name: high_cpu_utilization
                  event_name: '{#MODULE_NAME}: High CPU utilization (over {$CPU.UTIL.CRIT}% for 5m)'
                  opdata: 'Current utilization: {ITEM.LASTVALUE1}'
                  priority: WARNING
                  description: 'The CPU utilization is too high. The system might be slow to respond.'
                  manual_close: 'YES'
                  tags:
                    - tag: entity
                      value: '{#MODULE_NAME}'
            - uuid: fec9457741a44034aa53a644102c8619
              name: memory_utilization
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.25506.2.6.1.1.1.1.8.{#SNMPINDEX}'
              key: 'vm.memory.util[hh3cEntityExtMemUsage.{#SNMPINDEX}]'
              delay: 3m
              history: 7d
              value_type: FLOAT
              trends: '0'
              units: '%'
              description: |
                MIB: HH3C-ENTITY-EXT-MIB
                The memory usage for the entity. This object indicates what
                percent of memory are used.
              tags:
                - tag: entity
                  value: '{#MODULE_NAME}'
              trigger_prototypes:
                - uuid: 34328b0c8ce241f3b61a1835c0081dfa
                  expression: 'min(/template_h3c_basic/vm.memory.util[hh3cEntityExtMemUsage.{#SNMPINDEX}],5m)>{$MEMORY.UTIL.HIGH}'
                  name: high_memory_utilization
                  event_name: '{#MODULE_NAME}: High memory utilization (>{$MEMORY.UTIL.MAX}% for 5m)'
                  priority: AVERAGE
                  description: 'The system is running out of free memory.'
                  manual_close: 'YES'
                  tags:
                    - tag: entity
                      value: '{#MODULE_NAME}'
          graph_prototypes:
            - uuid: a5dde708c2404fe2b3c6c3f153ac76ef
              name: '{#MODULE_NAME}: CPU utilization'
              ymin_type_1: FIXED
              ymax_type_1: FIXED
              graph_items:
                - drawtype: GRADIENT_LINE
                  color: 199C0D
                  item:
                    host: template_h3c_basic
                    key: 'system.cpu.util[hh3cEntityExtCpuUsage.{#SNMPINDEX}]'
            - uuid: 6879be0b36274ac49f6dc7b94e932246
              name: '{#MODULE_NAME}: Memory utilization'
              ymin_type_1: FIXED
              ymax_type_1: FIXED
              graph_items:
                - drawtype: GRADIENT_LINE
                  color: 199C0D
                  item:
                    host: template_h3c_basic
                    key: 'vm.memory.util[hh3cEntityExtMemUsage.{#SNMPINDEX}]'
        - uuid: 27cdd2f6fa454dd7aca5bcf33779a453
          name: psu_discovery
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#INDEX},1.3.6.1.4.1.25506.8.35.9.1.2.1.3]'
          key: psu.discoveryv2
          delay: 1h
          lifetime_type: DELETE_IMMEDIATELY
          lifetime: '0'
          description: |
            hh3cdevMPowerStatusTable
            hh3cDevMPowerEntIndex
          item_prototypes:
            - uuid: c5751bdd2417432fbbe35dd885c7a4dd
              name: power_supply_status
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.25506.8.35.9.1.2.1.2.{#SNMPINDEX}'
              key: 'hh3c.devm.power.status.[{#INDEX}]'
              delay: 3m
              history: 7d
              trends: '0'
              description: hh3cDevMPowerStatus
              preprocessing:
                - type: JAVASCRIPT
                  parameters:
                    - |
                      if (value >= 2) {
                          return 2
                      } else {
                          return 1
                      }
              tags:
                - tag: power
                  value: '{#INDEX}'
              trigger_prototypes:
                - uuid: d886f804a8ef4a31ad6609126b206e80
                  expression: 'min(/template_h3c_basic/hh3c.devm.power.status.[{#INDEX}],#3)>1'
                  recovery_mode: RECOVERY_EXPRESSION
                  recovery_expression: 'last(/template_h3c_basic/hh3c.devm.power.status.[{#INDEX}],#1)=1'
                  name: power_supply_is_in_critical_state
                  priority: WARNING
                  manual_close: 'YES'
                  tags:
                    - tag: power
                      value: '{#INDEX}'
        - uuid: 15c59e272f1b430f814580f12c097734
          name: temperature_discovery
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#SNMPVALUE},1.3.6.1.2.1.47.1.1.1.1.2,{#MODULE_NAME},1.3.6.1.2.1.47.1.1.1.1.7]'
          key: temp.discovery
          delay: 1h
          filter:
            evaltype: OR
            conditions:
              - macro: '{#SNMPVALUE}'
                value: '(Fabric|FABRIC) (.+) (Module|MODULE)'
                formulaid: A
              - macro: '{#SNMPVALUE}'
                value: '(T|t)emperature.*(s|S)ensor'
                formulaid: B
              - macro: '{#SNMPVALUE}'
                value: '^(MODULE|Module) (LEVEL|level)1$'
                formulaid: C
          lifetime_type: DELETE_IMMEDIATELY
          lifetime: '0'
          description: 'Discovering modules temperature (same filter as in Module Discovery) plus and temperature sensors'
          item_prototypes:
            - uuid: a0971bbe865a4a51b4107eb41cba1843
              name: temperature
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.25506.2.6.1.1.1.1.12.{#SNMPINDEX}'
              key: 'sensor.temp.value[hh3cEntityExtTemperature.{#SNMPINDEX}]'
              delay: 3m
              history: 7d
              value_type: FLOAT
              trends: '0'
              units: °C
              description: |
                MIB: HH3C-ENTITY-EXT-MIB
                The temperature for the {#SNMPVALUE}.
              tags:
                - tag: entity
                  value: '{#SNMPVALUE}'
              trigger_prototypes:
                - uuid: 629ed835e45a4b9fb0bdf993b570efd7
                  expression: 'avg(/template_h3c_basic/sensor.temp.value[hh3cEntityExtTemperature.{#SNMPINDEX}],5m)>{$TEMP_CRIT:"{#SNMPVALUE}"}'
                  recovery_mode: NONE
                  name: temperature_is_above_warning_threshold
                  event_name: '{#SNMPVALUE}: Temperature is above warning threshold: >{$TEMP_CRIT:"{#SNMPVALUE}"}'
                  opdata: 'Current value: {ITEM.LASTVALUE1}'
                  priority: HIGH
                  description: 'This trigger uses temperature sensor values as well as temperature sensor status if available'
                  manual_close: 'YES'
                  tags:
                    - tag: entity
                      value: '{#SNMPVALUE}'
      macros:
        - macro: '{$CPU.USAGE.HIGH}'
          value: '90'
        - macro: '{$FAN_CRIT_STATUS}'
          value: '2'
        - macro: '{$ICMP_LOSS_WARN}'
          value: '20'
        - macro: '{$ICMP_RESPONSE_TIME_WARN}'
          value: '0.15'
        - macro: '{$MEMORY.UTIL.HIGH}'
          value: '90'
        - macro: '{$PSU_CRIT_STATUS}'
          value: '2'
        - macro: '{$SNMP.TIMEOUT}'
          value: 5m
        - macro: '{$TEMP_CRIT}'
          value: '75'
        - macro: '{$TEMP_CRIT_LOW}'
          value: '5'
        - macro: '{$TEMP_WARN}'
          value: '50'
      valuemaps:
        - uuid: b5fa3f46e5cb466697f229735aeecff5
          name: entity_status
          mappings:
            - value: '1'
              newvalue: normal
            - value: '2'
              newvalue: abnormal
        - uuid: e00c1135c8a84659ae4bc7c8d5143380
          name: 'EtherLike-MIB::dot3StatsDuplexStatus'
          mappings:
            - value: '1'
              newvalue: unknown
            - value: '2'
              newvalue: halfDuplex
            - value: '3'
              newvalue: fullDuplex
        - uuid: 248a9e07aedc46c5b360380fc5e40d41
          name: 'HH3C-ENTITY-EXT-MIB::hh3cEntityExtErrorStatus'
          mappings:
            - value: '1'
              newvalue: notSupported
            - value: '2'
              newvalue: normal
            - value: '3'
              newvalue: postFailure
            - value: '4'
              newvalue: entityAbsent
            - value: '11'
              newvalue: poeError
            - value: '21'
              newvalue: stackError
            - value: '22'
              newvalue: stackPortBlocked
            - value: '23'
              newvalue: stackPortFailed
            - value: '31'
              newvalue: sfpRecvError
            - value: '32'
              newvalue: sfpSendError
            - value: '33'
              newvalue: sfpBothError
            - value: '41'
              newvalue: fanError
            - value: '51'
              newvalue: psuError
            - value: '61'
              newvalue: rpsError
            - value: '71'
              newvalue: moduleFaulty
            - value: '81'
              newvalue: sensorError
            - value: '91'
              newvalue: hardwareFaulty
        - uuid: 2e58190d97854bdfbbfffac0c38a64fc
          name: 'IF-MIB::ifOperStatus'
          mappings:
            - value: '1'
              newvalue: up
            - value: '2'
              newvalue: down
            - value: '4'
              newvalue: unknown
            - value: '5'
              newvalue: dormant
            - value: '6'
              newvalue: notPresent
            - value: '7'
              newvalue: lowerLayerDown
        - uuid: 92e72678dfc34044984a584fcd5a2eeb
          name: 'Service state'
          mappings:
            - value: '0'
              newvalue: Down
            - value: '1'
              newvalue: Up
        - uuid: 6515ea55a5404ad69aa24a92fc537005
          name: zabbix.host.available
          mappings:
            - value: '0'
              newvalue: 'not available'
            - value: '1'
              newvalue: available
            - value: '2'
              newvalue: unknown
